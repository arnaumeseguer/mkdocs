<!doctype html>
<html lang="en">

<head>
        <title>Sprint3 - Projecte Arnau</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        
        
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="../assets/css/darcula-highlight.min.css">

        <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="../assets/css/dracula-ui.min.css">
        <link rel="stylesheet" href="../assets/css/mkdocs.min.css">

        
            <link  rel="icon" type="image/x-icon" href="../assets/img/favicon.ico">
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
                <script>hljs.initHighlightingOnLoad();</script>

</head>

<body class="drac-bg-black-secondary drac-text-grey-ternary drac-text drac-scrollbar-purple">

    <main class="d-flex">

        <!-- block sidebar -->
            <nav id="sidebar" class="sidebar drac-bg-black">
    <div class="custom-menu">
        <button type="button" id="sidebarCollapse" class="btn btn-primary">
            <i class="fa fa-bars"></i>
            <span class="sr-only">Menu</span>
        </button>
    </div>

    <div class="p-4">
        

        <div class="drac-text-center">
            
                <span class="drac-text drac-line-height drac-text-white">Projecte Arnau</span>
            
        </div>

        <div class="drac-box flex-column">
            <ul class="dot-ul">
                <li><div class="dot-li drac-bg-cyan"></div></li>
                <li><div class="dot-li drac-bg-green"></div></li>
                <li><div class="dot-li drac-bg-orange"></div></li>
                <li><div class="dot-li drac-bg-pink"></div></li>
                <li><div class="dot-li drac-bg-purple"></div></li>
                <li><div class="dot-li drac-bg-red"></div></li>
                <li><div class="dot-li drac-bg-yellow"></div></li>
            </ul>
        </div>

        <hr class="drac-divider" />

        <!-- block menu -->
        <ul class="mb-5 drac-list drac-list-none">
            
            <li class="drac-box">
                <a href=".."
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Pàgina Principal
                </a>
            </li>
            <li class="drac-box">
                <a href="../Sprint2/"
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Sprint2
                </a>
            </li>
            <li class="drac-box">
                <a href="./"
                    class=" active 
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Sprint3
                </a>
            </li>
        </ul>
        <!-- endblock -->
    </div>
</nav>
        <!-- endblock -->

        <nav class="divider drac-bg-purple-cyan"></nav>

        <div class="content">
            <!-- block header -->
                <header>
    <nav class="navbar navbar-expand-xl drac-bg-purple">
        <div class="container-fluid">
            
            <button class="navbar-toggler w-100 text-center" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMenu"
                aria-controls="navbarsMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse flex-column ml-auto" id="navbarsMenu">
                <ul class="navbar-nav text-md-center">

                    <!-- block preview -->
                    <li class="nav-item">
                            
        <div class="container">
            <div class="row row-preview">
                <div class="col">
                    <a href="../Sprint2/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </div>
                <div class="col">
                    <a 
                        class="btn-preview drac-btn drac-text-white--hover disabled" style="padding-left: 3%;">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
                    </li>
                    <!--  endblock -->

                    <!-- block search -->
                    <li class="nav-item"><div role="search" class="search-box">
	<form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
		<input type="text" name="q" class="drac-input drac-input-search drac-input-white drac-text-white drac-bg-black-secondary"
		placeholder="Search docs" title="Type search term here" />
	</form>
</div>
                    </li>
                    <!--  endblock -->

                    <!-- block source -->
                    <li class="nav-item">
                        
                    </li>
                    <!--  endblock -->

                </ul>
            </div>

        </div>
    </nav>
</header>
            <!-- endblock -->

            <!-- block content -->
                <section class="p-md-5 section-content">
    <article>
        <p><h1 id="sprint-3">Sprint 3</h1>
<h2 id="1-installacio-domini-ldap">1. Instal·lació domini LDAP</h2>
<p>Primer canviem el hostname i afegim el nom del domini que estarem utilitzant durant la manipulaicó del ldap.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%201.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/48ad6ffb-263e-4d1a-b575-0342f912cf2f.png" /></p>
<p>Ara, instal·lem els recursos necessaris per utilitzar l’ldap i configurem una contrasenya.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%202.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%203.png" /></p>
<p><strong>Per fer la base del domini hi ha dos opcions:</strong></p>
<ul>
<li>fer-ho a través dels arxius base .ldif</li>
<li>fer-ho a través d’una comanda (la que utilitzarem nosaltres)</li>
</ul>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%204.png" /></p>
<p>Durant el procés seleccionem gairebé totes les opcions per defecte, ja que per al que volem fer, és més que suficient.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%205.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%206.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%207.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%208.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%209.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2010.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2011.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2012.png" /></p>
<p>Finalment veiem com amb la comanda <code>slapcat</code> sen’s mostra el nou domini i la seva organització.</p>
<h2 id="2-unir-equips-al-domini">2. Unir equips al domini</h2>
<p>Crearem una unitat organitzativa, que es un contenidor dins del directori per guardar objectes com: usuaris i grups.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2013.png" /></p>
<p>Creem un grup anomenat alumnes per a poder posar els usuaris creats i posem els usuaris que volem afegir a la part inferior.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2014.png" /></p>
<p>Ara configurem el fitxer de l’usuari per a poder utilitzar-lo en la maquina client.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2015.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2016.png" /></p>
<p><code>-c</code> fa que el <code>ldapadd</code> continuï executant-se encara que es produeixin errors.</p>
<p><code>-x</code> utilitza autenticació simple en lloc de SASL (Simple Authentication and Security Layer).</p>
<p><code>-D</code> indica el Distinguished Name (DN) de l'usuari que realitza l'operació, en aquest cas, l'usuari administrador.</p>
<p><code>-W</code> demana la contrasenya de l'usuari especificat amb <code>-D</code>. Això és més segur que incloure la contrasenya directament a la comanda com passaria amb la <code>-w</code>.</p>
<p>Executem tots els canvis i verifiquem que s’han enregistrat correctament</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2017.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2018.png" /></p>
<hr />
<h3 id="un-cop-a-la-maquina-client">Un cop a la maquina client</h3>
<p>Instal·lem el “nscd”: un dimoni (programa en segon pla) que s’encarrega d’emmagatzemar la memòria cau(cache). Instal·lem també una llibreria que ens permetrà fer la connexió al domini “ldap” des del client amb <code>apt install libnss-ldap</code>.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2019.png" /></p>
<p>Fiquem la “ip” del server (sense la “i” i en 2 barres) per conectar-nos.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2020.png" /></p>
<p>Podem anar seleccionant també les opcions per defecte, que ja en van bé.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2021.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2022.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2023.png" /></p>
<p>Aquí haurem d’indicar el domini personalitzat que hem escollit abans i després introduïr la contrasenya.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2024.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2025.png" /></p>
<p>Instal·lem <code>apt install libpam-ldap</code> .</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2026.png" /></p>
<p>Si el client no es pot validar al domini, apart de comprovar els arxius de configuració que es veuran a continuació tambe farem sempre la següent comanda: <code>dpkg-reconfigure ldap-auth-config</code>.</p>
<p>I un cop més podem usar les opcions per defecte.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2027.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2028.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2029.png" /></p>
<p>Modifiquem la configuració de Name Service Switch (NSS) per incloure <code>ldap</code> abans d'altres mètodes de resolució (<code>compat</code>, <code>files</code>, <code>systemd</code>, <code>sss</code>).</p>
<p>Ara l'autenticació i la gestió d'usuaris es basarà primer en LDAP abans de consultar altres mecanismes locals.</p>
<p>Això permet que usuaris gestionats per LDAP puguin autenticar-se sense necessitat d'estar registrats localment a la màquina.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2030.png" /></p>
<p>S'han afegit mòduls PAM per a <code>pam_ldap.so</code> i <code>pam_unix.so</code>, prioritzant l'autenticació mitjançant LDAP.</p>
<p>Es poden establir regles específiques com <code>use_authtok</code> i <code>try_first_pass</code>, que permeten reutilitzar credencials introduïdes prèviament per a evitar haver d'introduir-les diverses vegades.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2031.png" /></p>
<p>S'ha afegit <code>pam_mkhomedir.so skel=/etc/skel umask=077</code>, que assegura que es creï un directori d'inici (<code>home</code>) per als usuaris que s'autentiquen mitjançant LDAP.</p>
<p>Si un usuari LDAP inicia sessió per primer cop, el sistema crearà automàticament el seu directori <code>/home/usuari</code> amb permisos restringits (<code>umask=077</code>), evitant que altres usuaris puguin accedir als seus fitxers.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2032.png" /></p>
<p>Facilita que usuaris LDAP (o altres comptes no definits localment) puguin iniciar sessió introduint el seu nom d'usuari i contrasenya.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2033.png" /></p>
<p>Procedim a conectar-nos amb l’usuari que hem creat per verificar el funcionament:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2034.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2035.png" /></p>
<hr />
<h2 id="3-gestio-del-domini-ldap">3. Gestió del domini LDAP</h2>
<p>Un cop tenim un domini creat hem de ser capaços de gestinar-lo, ja sigui afegint, eliminant o modificant paràmetres del mateix.</p>
<p>Per fer-ho hem eliminat l’antiga base i n’hem creat una de nova amb <code>dpkg-reconfigure slapd</code></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2036.png" /></p>
<p><strong><em>Un breu video per mostra el procés de configuració pas per pas:</em></strong></p>
<p><a href="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/dpkg-reconfigure.mp4">dpkg-reconfigure.mp4</a></p>
<hr />
<h2 id="ldapsearch"><code>ldapsearch</code></h2>
<p>Una de les coses que podem fer per gestionar la nostra base de dades és filtrar per “uid”, una de les entrades que, en principi, ha de ser única per a cada entrada. Aixó ens mostra totes les dades que hi ha assignades a l’entrada en qüestió.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2037.png" /></p>
<p>També podem filtrar per coses més concretes. Podem, per exemple, filtrar per tots aquells usuaris que disposen d’un objecte “mail” que utilitzi el domini “example.com”. Si hi hagués objectes “mail” amb altres dominis no es mostrarien després de fer aquesta comanda.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2038.png" /></p>
<p>A més, podem fer una cerca que ens mostre només els objectes que ens interessen:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2039.png" /></p>
<p>En aquesta, hem afegit al final de la comanda: “dn” “cn” i “mail” com als únics camps que volem rebre de la cerca.</p>
<h2 id="afegir-dades">Afegir dades</h2>
<h3 id="primera-opcio-per-afegir-dades">Primera opció per afegir dades</h3>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2040.png" /></p>
<p>Afegim la base de dades al domini, que afegeix dos “ou” o unitats organitzatives: una per als grup i una altra per als usuaris.</p>
<p>També afegeix múltiples entrades per a cada grup.</p>
<hr />
<h3 id="segona-opcio-per-afegir-dades">Segona opció per afegir dades</h3>
<p>En aquest cas hem afegit manualment una ou a la base de dades, que es mostra juntament amb les altres dues anteriors.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2041.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2042.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2043.png" /></p>
<p>Com a resultat, obtenim una nova “ou”.</p>
<hr />
<p>Ara, imaginem que les dades que hem afegit amb la segona opció han estat incorrectes i volem modificar-les.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2044.png" /></p>
<p>Podem, per exemple, cambiar “l’ou” de manera que prova ara forma part de la “ou” “groups”.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2045.png" /></p>
<hr />
<p>Si per exemple volem cambiar el nom de la ou “prova” a “provahola” ho hem de fer de la següent forma:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2046.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2047.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2048.png" /></p>
<p>Aquests són processos que veurem més avant a l’apartat <strong>Per Modificar Dades</strong></p>
<hr />
<h2 id="esborrar-dades">Esborrar dades</h2>
<p>Per esborra dades utilitzarem el següent procés:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2049.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2050.png" /></p>
<p>Després d’eliminar ja no tenim l’entrada:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2051.png" /></p>
<hr />
<h2 id="per-modificar-dades">Per modificar dades</h2>
<p>Modificar les dades és un procés des del que podem afegir eliminar i modificar totes les dades sense necessitat de utilitzar una comanda individual per a cada objecte.</p>
<p>Podem fer un fitxer .ldif per a cada objecte o dada que volem modificar o podem fer-ne un que les inclogue totes.</p>
<p>Primer hem intentat esborrar l’atribut “sn”.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2052.png" /></p>
<p>Aquest ha donat error ja que el “sn” és un atribut obligatori i no podem deixar a “abergin” sense “sn”</p>
<p>Així que farem altres proves</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/461c00f7-d1ae-4a0a-9d88-e6c85125959f.png" /></p>
<p>El contingut del fitxer</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2053.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2054.png" /></p>
<p>Com a resultat, “abergin” té ara un hotmail i el seu “homeDirectory” ha cambiat de “/home/abergin” a “/home/abergin0”</p>
<p>Si volem eliminar el seu mail:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2055.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2056.png" /></p>
<p>Ara abergin ja no té mail.</p></p>
    </article>
</section>
            <!-- endblock -->

            <!-- block footer -->
                <footer>
    <div class="d-flex flex-sm-row justify-content-between py-2 border-top drac-text-black drac-bg-cyan-green">
        <a href="https://github.com/dracula/mkdocs" target="_blank" style="padding-left: 1%;"
            class="footer-text drac-anchor drac-text-black drac-text-purple--hover">
            Made with Dracula Theme for MkDocs
        </a>
    </div>
</footer>
            <!-- endblock -->
        </div>

    </main>

        <script>var base_url = '..';</script>
        <script src="../assets/js/jquery-3.3.1.slim.min.js"></script>
        <script src="../assets/js/bootstrap.bundle.min.js"></script>
        <script src="../assets/js/mkdocs.js"></script>
			<script src="../search/main.js" defer></script>

</body>

</html>