<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Sprint3 - Projecte Arnau</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Sprint 3", url: "#_top", children: [
              {title: "1. Instal\u00b7laci\u00f3 domini LDAP", url: "#1-installacio-domini-ldap" },
              {title: "2. Unir equips al domini", url: "#2-unir-equips-al-domini" },
              {title: "3. Gesti\u00f3 del domini LDAP", url: "#3-gestio-del-domini-ldap" },
              {title: "ldapsearch", url: "#ldapsearch" },
              {title: "Afegir dades", url: "#afegir-dades" },
              {title: "Esborrar dades", url: "#esborrar-dades" },
              {title: "Per modificar dades", url: "#per-modificar-dades" },
          ]},
        ];

    </script>
    <script src="../js/base.js"></script>
      <script src="../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav">
      <a href="../Sprint2/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Sprint2/" class="btn btn-xs btn-link">
        Sprint2
      </a>
    </div>
    
  </div>

    

    <h1 id="sprint-3">Sprint 3</h1>
<h2 id="1-installacio-domini-ldap">1. Instal·lació domini LDAP</h2>
<p>Primer canviem el hostname i afegim el nom del domini que estarem utilitzant durant la manipulaicó del ldap.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%201.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/48ad6ffb-263e-4d1a-b575-0342f912cf2f.png" /></p>
<p>Ara, instal·lem els recursos necessaris per utilitzar l’ldap i configurem una contrasenya.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%202.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%203.png" /></p>
<p><strong>Per fer la base del domini hi ha dos opcions:</strong></p>
<ul>
<li>fer-ho a través dels arxius base .ldif</li>
<li>fer-ho a través d’una comanda (la que utilitzarem nosaltres)</li>
</ul>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%204.png" /></p>
<p>Durant el procés seleccionem gairebé totes les opcions per defecte, ja que per al que volem fer, és més que suficient.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%205.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%206.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%207.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%208.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%209.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2010.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2011.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2012.png" /></p>
<p>Finalment veiem com amb la comanda <code>slapcat</code> sen’s mostra el nou domini i la seva organització.</p>
<h2 id="2-unir-equips-al-domini">2. Unir equips al domini</h2>
<p>Crearem una unitat organitzativa, que es un contenidor dins del directori per guardar objectes com: usuaris i grups.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2013.png" /></p>
<p>Creem un grup anomenat alumnes per a poder posar els usuaris creats i posem els usuaris que volem afegir a la part inferior.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2014.png" /></p>
<p>Ara configurem el fitxer de l’usuari per a poder utilitzar-lo en la maquina client.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2015.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2016.png" /></p>
<p><code>-c</code> fa que el <code>ldapadd</code> continuï executant-se encara que es produeixin errors.</p>
<p><code>-x</code> utilitza autenticació simple en lloc de SASL (Simple Authentication and Security Layer).</p>
<p><code>-D</code> indica el Distinguished Name (DN) de l'usuari que realitza l'operació, en aquest cas, l'usuari administrador.</p>
<p><code>-W</code> demana la contrasenya de l'usuari especificat amb <code>-D</code>. Això és més segur que incloure la contrasenya directament a la comanda com passaria amb la <code>-w</code>.</p>
<p>Executem tots els canvis i verifiquem que s’han enregistrat correctament</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2017.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2018.png" /></p>
<hr />
<h3 id="un-cop-a-la-maquina-client">Un cop a la maquina client</h3>
<p>Instal·lem el “nscd”: un dimoni (programa en segon pla) que s’encarrega d’emmagatzemar la memòria cau(cache). Instal·lem també una llibreria que ens permetrà fer la connexió al domini “ldap” des del client amb <code>apt install libnss-ldap</code>.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2019.png" /></p>
<p>Fiquem la “ip” del server (sense la “i” i en 2 barres) per conectar-nos.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2020.png" /></p>
<p>Podem anar seleccionant també les opcions per defecte, que ja en van bé.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2021.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2022.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2023.png" /></p>
<p>Aquí haurem d’indicar el domini personalitzat que hem escollit abans i després introduïr la contrasenya.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2024.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2025.png" /></p>
<p>Instal·lem <code>apt install libpam-ldap</code> .</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2026.png" /></p>
<p>Si el client no es pot validar al domini, apart de comprovar els arxius de configuració que es veuran a continuació tambe farem sempre la següent comanda: <code>dpkg-reconfigure ldap-auth-config</code>.</p>
<p>I un cop més podem usar les opcions per defecte.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2027.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2028.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2029.png" /></p>
<p>Modifiquem la configuració de Name Service Switch (NSS) per incloure <code>ldap</code> abans d'altres mètodes de resolució (<code>compat</code>, <code>files</code>, <code>systemd</code>, <code>sss</code>).</p>
<p>Ara l'autenticació i la gestió d'usuaris es basarà primer en LDAP abans de consultar altres mecanismes locals.</p>
<p>Això permet que usuaris gestionats per LDAP puguin autenticar-se sense necessitat d'estar registrats localment a la màquina.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2030.png" /></p>
<p>S'han afegit mòduls PAM per a <code>pam_ldap.so</code> i <code>pam_unix.so</code>, prioritzant l'autenticació mitjançant LDAP.</p>
<p>Es poden establir regles específiques com <code>use_authtok</code> i <code>try_first_pass</code>, que permeten reutilitzar credencials introduïdes prèviament per a evitar haver d'introduir-les diverses vegades.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2031.png" /></p>
<p>S'ha afegit <code>pam_mkhomedir.so skel=/etc/skel umask=077</code>, que assegura que es creï un directori d'inici (<code>home</code>) per als usuaris que s'autentiquen mitjançant LDAP.</p>
<p>Si un usuari LDAP inicia sessió per primer cop, el sistema crearà automàticament el seu directori <code>/home/usuari</code> amb permisos restringits (<code>umask=077</code>), evitant que altres usuaris puguin accedir als seus fitxers.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2032.png" /></p>
<p>Facilita que usuaris LDAP (o altres comptes no definits localment) puguin iniciar sessió introduint el seu nom d'usuari i contrasenya.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2033.png" /></p>
<p>Procedim a conectar-nos amb l’usuari que hem creat per verificar el funcionament:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2034.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2035.png" /></p>
<hr />
<h2 id="3-gestio-del-domini-ldap">3. Gestió del domini LDAP</h2>
<p>Un cop tenim un domini creat hem de ser capaços de gestinar-lo, ja sigui afegint, eliminant o modificant paràmetres del mateix.</p>
<p>Per fer-ho hem eliminat l’antiga base i n’hem creat una de nova amb <code>dpkg-reconfigure slapd</code></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2036.png" /></p>
<p><strong><em>Un breu video per mostra el procés de configuració pas per pas:</em></strong></p>
<p><a href="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/dpkg-reconfigure.mp4">dpkg-reconfigure.mp4</a></p>
<hr />
<h2 id="ldapsearch"><code>ldapsearch</code></h2>
<p>Una de les coses que podem fer per gestionar la nostra base de dades és filtrar per “uid”, una de les entrades que, en principi, ha de ser única per a cada entrada. Aixó ens mostra totes les dades que hi ha assignades a l’entrada en qüestió.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2037.png" /></p>
<p>També podem filtrar per coses més concretes. Podem, per exemple, filtrar per tots aquells usuaris que disposen d’un objecte “mail” que utilitzi el domini “example.com”. Si hi hagués objectes “mail” amb altres dominis no es mostrarien després de fer aquesta comanda.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2038.png" /></p>
<p>A més, podem fer una cerca que ens mostre només els objectes que ens interessen:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2039.png" /></p>
<p>En aquesta, hem afegit al final de la comanda: “dn” “cn” i “mail” com als únics camps que volem rebre de la cerca.</p>
<h2 id="afegir-dades">Afegir dades</h2>
<h3 id="primera-opcio-per-afegir-dades">Primera opció per afegir dades</h3>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2040.png" /></p>
<p>Afegim la base de dades al domini, que afegeix dos “ou” o unitats organitzatives: una per als grup i una altra per als usuaris.</p>
<p>També afegeix múltiples entrades per a cada grup.</p>
<hr />
<h3 id="segona-opcio-per-afegir-dades">Segona opció per afegir dades</h3>
<p>En aquest cas hem afegit manualment una ou a la base de dades, que es mostra juntament amb les altres dues anteriors.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2041.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2042.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2043.png" /></p>
<p>Com a resultat, obtenim una nova “ou”.</p>
<hr />
<p>Ara, imaginem que les dades que hem afegit amb la segona opció han estat incorrectes i volem modificar-les.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2044.png" /></p>
<p>Podem, per exemple, cambiar “l’ou” de manera que prova ara forma part de la “ou” “groups”.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2045.png" /></p>
<hr />
<p>Si per exemple volem cambiar el nom de la ou “prova” a “provahola” ho hem de fer de la següent forma:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2046.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2047.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2048.png" /></p>
<p>Aquests són processos que veurem més avant a l’apartat <strong>Per Modificar Dades</strong></p>
<hr />
<h2 id="esborrar-dades">Esborrar dades</h2>
<p>Per esborra dades utilitzarem el següent procés:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2049.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2050.png" /></p>
<p>Després d’eliminar ja no tenim l’entrada:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2051.png" /></p>
<hr />
<h2 id="per-modificar-dades">Per modificar dades</h2>
<p>Modificar les dades és un procés des del que podem afegir eliminar i modificar totes les dades sense necessitat de utilitzar una comanda individual per a cada objecte.</p>
<p>Podem fer un fitxer .ldif per a cada objecte o dada que volem modificar o podem fer-ne un que les inclogue totes.</p>
<p>Primer hem intentat esborrar l’atribut “sn”.</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2052.png" /></p>
<p>Aquest ha donat error ja que el “sn” és un atribut obligatori i no podem deixar a “abergin” sense “sn”</p>
<p>Així que farem altres proves</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/461c00f7-d1ae-4a0a-9d88-e6c85125959f.png" /></p>
<p>El contingut del fitxer</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2053.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2054.png" /></p>
<p>Com a resultat, “abergin” té ara un hotmail i el seu “homeDirectory” ha cambiat de “/home/abergin” a “/home/abergin0”</p>
<p>Si volem eliminar el seu mail:</p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2055.png" /></p>
<p><img alt="image.png" src="../Sprint%203%2017b1cc235019808b89d2d6ef906d090c/image%2056.png" /></p>
<p>Ara abergin ja no té mail.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav">
      <a href="../Sprint2/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../Sprint2/" class="btn btn-xs btn-link">
        Sprint2
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="None">Windmill Dark</a> theme by None (noraj).</p>
</footer>

</body>
</html>